import{i as R,b as $,j as e,a2 as W,e as _,u as M,p as L,s as K,d as G,f as m,J as V,r as l,B as n,T as h,C as H,o as A,P as J,A as Q,m as U,t as g,I as y,a3 as X,K as N,z as d}from"./index-DiJP0-9s.js";import{d as Y,a as Z}from"./Refresh-DCOeZUIP.js";import{d as ee}from"./CheckCircle-C44imApy.js";import{d as ae}from"./Person-BavuKjIp.js";import{d as se}from"./AccessTime-HHnC3-Xg.js";import{F as te,S as re}from"./Switch-D4zRtLYl.js";import{F as ie}from"./Fab-BEsy00f2.js";import{T as ne,a as oe,b as le,c as k,d as r,e as ce}from"./TableRow-CA4P7yCv.js";import{C as de}from"./Chip-BhGZD8wh.js";import{D as xe}from"./Dialog--eHXLavO.js";import{D as me,a as he,b as pe}from"./DialogTitle-DMgumv3i.js";var w={},ue=R;Object.defineProperty(w,"__esModule",{value:!0});var I=w.default=void 0,je=ue($()),fe=e;I=w.default=(0,je.default)((0,fe.jsx)("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School");const b="nashmi_chat",p={async getAllLogs(){try{return(await G(_(m,b))).docs.map(s=>{var c;return{id:s.id,...s.data(),timestamp:(c=s.data().timestamp)!=null&&c.toDate?s.data().timestamp.toDate():new Date(s.data().timestamp||Date.now())}}).sort((s,c)=>c.timestamp-s.timestamp)}catch(t){return console.error("Error fetching Nashmi logs:",t),[]}},async deleteLog(t){await K(L(m,b,t))},async updateStatus(t,s){await M(L(m,b,t),{status:s})},async addLogToKnowledge(t,s){await W(_(m,"nashmi_knowledge"),{question:t,answer:s,verifiedAt:V(),source:"admin_training"})}};function Ae(){const[t,s]=l.useState([]),[c,v]=l.useState(!0),[i,E]=l.useState(null),[u,D]=l.useState(""),[z,x]=l.useState(!1),[C,O]=l.useState(!1),S=async()=>{v(!0);const a=await p.getAllLogs();s(a),v(!1)};l.useEffect(()=>{S()},[]);const P=a=>{if(!a)return"Ø¨Ø¯ÙˆÙ† ØªØ§Ø±ÙŠØ®";try{if(a.toDate)return a.toDate().toLocaleString("ar-EG");const o=new Date(a);return isNaN(o.getTime())?"ØªØ§Ø±ÙŠØ® ØºÙŠØ± ØµØ§Ù„Ø­":o.toLocaleString("ar-EG")}catch{return"Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ§Ø±ÙŠØ®"}},q=async a=>{window.confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ")&&(await p.deleteLog(a),d.success("ØªÙ… Ø§Ù„Ø­Ø°Ù Ø¨Ù†Ø¬Ø§Ø­"),s(o=>o.filter(j=>j.id!==a)))},T=async(a,o)=>{await p.updateStatus(a,o),d.success("ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ«"),s(j=>j.map(f=>f.id===a?{...f,status:o}:f))},B=a=>{E(a),D(""),x(!0)},F=async()=>{if(!u.trim())return d.error("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¥Ø¬Ø§Ø¨Ø©");try{await p.addLogToKnowledge(i.message||i.question,u),await T(i.id,"reviewed"),d.success("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø© Ù„Ù†Ø´Ù€Ù…ÙŠ Ø¨Ù†Ø¬Ø§Ø­! ğŸ¤–"),x(!1)}catch{d.error("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ¯Ø±ÙŠØ¨")}};return e.jsxs(n,{children:[e.jsxs(n,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(h,{variant:"h4",fontWeight:"bold",children:"Ø³Ø¬Ù„Ø§Øª Ù†Ø´Ù…ÙŠ Ø´Ø§Øª"}),e.jsxs(n,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(te,{control:e.jsx(re,{checked:C,onChange:a=>O(a.target.checked),color:"primary"}),label:"ØºÙŠØ± Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹ ÙÙ‚Ø·"}),e.jsx(ie,{color:"primary",size:"small",onClick:S,children:e.jsx(Y,{})})]})]}),c?e.jsx(n,{display:"flex",justifyContent:"center",mt:10,children:e.jsx(H,{})}):e.jsxs(A.div,{initial:{opacity:0},animate:{opacity:1},children:[e.jsx(ne,{component:J,className:"glass-panel",sx:{background:"transparent",boxShadow:"none"},children:e.jsxs(oe,{sx:{minWidth:650},children:[e.jsx(le,{children:e.jsxs(k,{children:[e.jsx(r,{sx:{color:"text.secondary"},children:"Ø§Ù„Ø³Ø¤Ø§Ù„"}),e.jsx(r,{sx:{color:"text.secondary"},children:"Ø§Ù„Ø·Ø§Ù„Ø¨"}),e.jsx(r,{sx:{color:"text.secondary"},children:"Ø§Ù„ØªÙˆÙ‚ÙŠØª"}),e.jsx(r,{sx:{color:"text.secondary"},children:"Ø§Ù„Ø­Ø§Ù„Ø©"}),e.jsx(r,{sx:{color:"text.secondary"},children:"Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª"})]})}),e.jsx(ce,{children:e.jsx(Q,{children:t.filter(a=>!C||a.status!=="reviewed").map(a=>e.jsxs(k,{component:A.tr,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},sx:{"&:hover":{bgcolor:"rgba(255,255,255,0.02)"}},children:[e.jsx(r,{sx:{color:"white",maxWidth:400},children:e.jsxs(n,{display:"flex",gap:1.5,children:[e.jsx(U,{color:"primary",sx:{mt:.5}}),e.jsx(h,{variant:"body2",children:a.message||a.question})]})}),e.jsx(r,{sx:{color:"rgba(255,255,255,0.7)"},children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(ae,{fontSize:"small"}),a.studentName||"Ù…Ø¬Ù‡ÙˆÙ„"]})}),e.jsx(r,{sx:{color:"rgba(255,255,255,0.6)"},children:e.jsxs(n,{display:"flex",alignItems:"center",gap:1,children:[e.jsx(se,{fontSize:"small"}),P(a.timestamp||a.createdAt)]})}),e.jsx(r,{children:e.jsx(de,{label:a.status==="reviewed"?"ØªÙ…Øª Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©":"Ø¬Ø¯ÙŠØ¯",color:a.status==="reviewed"?"success":"warning",variant:"outlined",size:"small"})}),e.jsx(r,{children:e.jsxs(n,{display:"flex",gap:1,children:[e.jsx(g,{title:"ØªØ¯Ø±ÙŠØ¨ Ù†Ø´Ù€Ù…ÙŠ",children:e.jsx(y,{color:"info",onClick:()=>B(a),children:e.jsx(I,{})})}),a.status!=="reviewed"&&e.jsx(g,{title:"ØªÙ…ÙŠÙŠØ² ÙƒÙ€ Ù…Ø±Ø§Ø¬Ø¹",children:e.jsx(y,{color:"success",onClick:()=>T(a.id,"reviewed"),children:e.jsx(ee,{})})}),e.jsx(g,{title:"Ø­Ø°Ù",children:e.jsx(y,{color:"error",onClick:()=>q(a.id),children:e.jsx(Z,{})})})]})})]},a.id))})})]})}),t.length===0&&e.jsx(n,{textAlign:"center",py:10,color:"text.secondary",children:"Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³Ø¬Ù„Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹"})]}),e.jsxs(xe,{open:z,onClose:()=>x(!1),PaperProps:{className:"glass-panel",sx:{bgcolor:"rgba(26,26,26,0.95)",minWidth:500}},children:[e.jsx(me,{children:"ØªØ¯Ø±ÙŠØ¨ Ù†Ø´Ù€Ù…ÙŠ ğŸ¤–"}),e.jsxs(he,{children:[e.jsx(h,{variant:"subtitle2",color:"primary",gutterBottom:!0,sx:{mt:2},children:"Ø§Ù„Ø³Ø¤Ø§Ù„:"}),e.jsx(h,{variant:"body1",sx:{mb:3,p:2,bgcolor:"rgba(255,255,255,0.05)",borderRadius:2},children:(i==null?void 0:i.message)||(i==null?void 0:i.question)}),e.jsx(X,{fullWidth:!0,multiline:!0,rows:4,label:"Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ÙŠØ©",placeholder:"Ø§ÙƒØªØ¨ Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØªÙŠ ÙŠØ¬Ø¨ Ø£Ù† ÙŠØªØ°ÙƒØ±Ù‡Ø§ Ù†Ø´Ù…ÙŠ...",value:u,onChange:a=>D(a.target.value),variant:"outlined"})]}),e.jsxs(pe,{sx:{p:3},children:[e.jsx(N,{onClick:()=>x(!1),color:"inherit",children:"Ø¥Ù„ØºØ§Ø¡"}),e.jsx(N,{onClick:F,variant:"contained",color:"primary",children:"Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©"})]})]})]})}export{Ae as default};
