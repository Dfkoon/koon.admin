import{c as C,j as s,k as D,i as g,u as T,d as I,e as z,f as d,r as p,B as i,T as n,C as A,A as S,m as k,l as x,I as h,z as v}from"./index-BkniLVl-.js";import{F as E}from"./Fab-CNu5vf9D.js";import{R as L,C as F,D as R}from"./Refresh-DkUl10bN.js";import{G as b}from"./Grid-BSClNp5Q.js";import{C as B}from"./CheckCircle-BnFsqlJl.js";const M=C(s.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),N=C(s.jsx("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"}),"FormatQuote"),j="testimonials",u={async getAllTestimonials(){try{return(await I(z(d,j))).docs.map(a=>{var o;return{id:a.id,...a.data(),date:(o=a.data().createdAt)!=null&&o.toDate?a.data().createdAt.toDate():new Date(a.data().createdAt||Date.now())}}).sort((a,o)=>o.date-a.date)}catch(t){return console.error("Error fetching testimonials:",t),[]}},async updateStatus(t,a){const o=g(d,j,t);await T(o,{status:a,approved:a==="approved"})},async deleteTestimonial(t){await D(g(d,j,t))}};function V(){const[t,a]=p.useState([]),[o,m]=p.useState(!0),f=async()=>{m(!0);const e=await u.getAllTestimonials();a(e),m(!1)};p.useEffect(()=>{f()},[]);const y=async(e,r)=>{await u.updateStatus(e,r),v.success(r==="approved"?"تمت الموافقة":"تم الرفض"),a(c=>c.map(l=>l.id===e?{...l,status:r,approved:r==="approved"}:l))},w=async e=>{window.confirm("هل أنت متأكد من الحذف؟")&&(await u.deleteTestimonial(e),v.success("تم الحذف"),a(r=>r.filter(c=>c.id!==e)))};return s.jsxs(i,{children:[s.jsxs(i,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(n,{variant:"h4",fontWeight:"bold",children:"إدارة آراء الطلاب"}),s.jsx(E,{color:"primary",size:"small",onClick:f,children:s.jsx(L,{})})]}),o?s.jsx(i,{display:"flex",justifyContent:"center",height:"50vh",alignItems:"center",children:s.jsx(A,{})}):s.jsx(b,{container:!0,spacing:3,children:s.jsx(S,{children:t.map((e,r)=>s.jsx(b,{item:!0,xs:12,sm:6,md:4,children:s.jsx(k.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:r*.05},children:s.jsxs(i,{className:"glass-card",sx:{p:3,height:"100%",position:"relative",border:e.approved?"1px solid var(--success)":"1px solid var(--glass-border)",boxShadow:e.approved?"0 0 15px rgba(0, 230, 118, 0.1)":"none"},children:[s.jsx(N,{sx:{fontSize:40,color:"var(--primary)",opacity:.3,position:"absolute",top:10,left:10}}),s.jsxs(i,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(n,{variant:"h6",fontWeight:"bold",children:e.name}),s.jsx(F,{label:e.status==="approved"?"معتمد":e.status==="rejected"?"مرفوض":"قيد الانتظار",color:e.status==="approved"?"success":e.status==="rejected"?"error":"warning",size:"small"})]}),s.jsxs(n,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.major," - السنة ",e.year]}),s.jsxs(n,{variant:"body1",sx:{minHeight:80,mb:2,fontStyle:"italic",color:"rgba(255,255,255,0.9)"},children:['"',e.message,'"']}),s.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:"auto",pt:2,borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.status!=="approved"&&s.jsx(x,{title:"اعتماد",children:s.jsx(h,{color:"success",onClick:()=>y(e.id,"approved"),children:s.jsx(B,{})})}),e.status!=="rejected"&&s.jsx(x,{title:"رفض",children:s.jsx(h,{color:"warning",onClick:()=>y(e.id,"rejected"),children:s.jsx(M,{})})}),s.jsx(x,{title:"حذف",children:s.jsx(h,{color:"error",onClick:()=>w(e.id),children:s.jsx(R,{})})})]})]})})},e.id))})})]})}export{V as default};
