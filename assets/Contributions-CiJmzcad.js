import{i as S,b as E,j as e,Z as L,$ as R,a0 as P,s as W,p as _,f as b,u as $,d as F,e as q,J as H,r as h,B as i,T as x,C as N,P as O,A as B,o as M,I as p,h as U,t as g,z as u}from"./index-DiJP0-9s.js";import{d as V}from"./CheckCircle-C44imApy.js";import{d as J,a as Z}from"./Close-VJPl8f65.js";import{d as G,a as K}from"./Refresh-DCOeZUIP.js";import{F as Q}from"./Fab-BEsy00f2.js";import{T as X,a as Y,b as ee,c as D,d as a,e as se}from"./TableRow-CA4P7yCv.js";import{C as j}from"./Chip-BhGZD8wh.js";import{D as te}from"./Dialog--eHXLavO.js";var y={},re=S;Object.defineProperty(y,"__esModule",{value:!0});var k=y.default=void 0,ae=re(E()),oe=e;k=y.default=(0,ae.default)((0,oe.jsx)("path",{d:"M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5"}),"Link");const m="quizContributions",v={async getAllContributions(){try{return(await F(q(b,m))).docs.map(t=>{var r;return{id:t.id,...t.data(),date:(r=t.data().createdAt)!=null&&r.toDate?t.data().createdAt.toDate():new Date(t.data().createdAt||Date.now())}}).sort((t,r)=>r.date-t.date)}catch(o){return console.error("Error fetching contributions:",o),[]}},async updateStatus(o,t){const r=_(b,m,o),c={status:t};t==="approved"&&(c.approvedAt=H()),await $(r,c)},async deleteContribution(o,t){try{if(t){const r=L(R,t);await P(r)}await W(_(b,m,o))}catch(r){throw console.error("Error deleting contribution:",r),r}}};function ue(){const[o,t]=h.useState([]),[r,c]=h.useState(!0),[C,f]=h.useState(null),w=async()=>{c(!0);const s=await v.getAllContributions();t(s),c(!1)};h.useEffect(()=>{w()},[]);const T=async(s,l)=>{try{await v.updateStatus(s,l),u.success(l==="approved"?"تمت الموافقة على المساهمة":"تم الرفض"),t(n=>n.map(d=>d.id===s?{...d,status:l}:d))}catch{u.error("حدث خطأ أثناء تحديث الحالة")}},z=async(s,l)=>{if(window.confirm("هل أنت متأكد من حذف هذه المساهمة نهائياً؟"))try{await v.deleteContribution(s,l),u.success("تم الحذف بنجاح"),t(n=>n.filter(d=>d.id!==s))}catch{u.error("فشل الحذف")}},I=s=>s==="link"?e.jsx(j,{label:"رابط",color:"info",size:"small",variant:"outlined"}):s!=null&&s.includes("pdf")?e.jsx(j,{label:"PDF",color:"error",size:"small",variant:"outlined"}):e.jsx(j,{label:"صورة",color:"primary",size:"small",variant:"outlined"}),A=s=>({past_papers:"أسئلة سنوات",quizzes:"كويزات",summaries:"ملخصات",material_pdf:"مادة PDF",external_link:"رابط ملف"})[s]||"غير محدد";return e.jsxs(i,{children:[e.jsxs(i,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(i,{children:[e.jsx(x,{variant:"h4",fontWeight:"bold",children:"مساهمات الطلاب"}),e.jsx(x,{variant:"body2",color:"text.secondary",children:"مراجعة الملفات والكويزات المرفوعة من قبل الطلاب"})]}),e.jsx(Q,{color:"primary",size:"small",onClick:w,children:e.jsx(G,{})})]}),r?e.jsx(i,{display:"flex",justifyContent:"center",height:"50vh",alignItems:"center",children:e.jsx(N,{})}):e.jsx(X,{component:O,className:"glass-panel",sx:{background:"transparent",boxShadow:"none"},children:e.jsxs(Y,{sx:{minWidth:800},children:[e.jsx(ee,{children:e.jsxs(D,{children:[e.jsx(a,{sx:{color:"text.secondary"},children:"المادة / النوع"}),e.jsx(a,{sx:{color:"text.secondary"},children:"الملف"}),e.jsx(a,{sx:{color:"text.secondary"},children:"معاينة"}),e.jsx(a,{sx:{color:"text.secondary"},children:"الحالة"}),e.jsx(a,{sx:{color:"text.secondary",textAlign:"center"},children:"إجراءات"})]})}),e.jsx(se,{children:e.jsx(B,{children:o.map((s,l)=>{var n;return e.jsxs(D,{component:M.tr,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},sx:{"&:hover":{bgcolor:"rgba(211, 47, 47, 0.05)"},transition:"0.2s"},children:[e.jsxs(a,{children:[e.jsx(x,{fontWeight:"bold",children:s.studentName||"عام"}),e.jsx(x,{variant:"caption",color:"primary",children:A(s.contributionType)})]}),e.jsx(a,{children:e.jsxs(i,{sx:{display:"flex",alignItems:"center",gap:1},children:[I(s.fileType),e.jsx(x,{variant:"body2",sx:{maxWidth:200,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:s.fileName})]})}),e.jsx(a,{children:(n=s.fileType)!=null&&n.startsWith("image/")?e.jsx(i,{component:"img",src:s.fileUrl,sx:{width:50,height:50,borderRadius:1,objectFit:"cover",cursor:"pointer",border:"1px solid rgba(255,255,255,0.1)","&:hover":{transform:"scale(1.1)"},transition:"0.2s"},onClick:()=>f(s.fileUrl)}):e.jsx(p,{size:"small",onClick:()=>window.open(s.fileUrl,"_blank"),children:s.fileType==="link"?e.jsx(k,{}):e.jsx(U,{})})}),e.jsx(a,{children:e.jsx(j,{label:s.status==="approved"?"مقبول":s.status==="rejected"?"مرفوض":"قيد المراجعة",color:s.status==="approved"?"success":s.status==="rejected"?"error":"warning",size:"small"})}),e.jsx(a,{sx:{textAlign:"center"},children:e.jsxs(i,{sx:{display:"flex",gap:.5,justifyContent:"center"},children:[s.status==="pending"&&e.jsx(g,{title:"موافقة",children:e.jsx(p,{color:"success",size:"small",onClick:()=>T(s.id,"approved"),children:e.jsx(V,{})})}),s.status!=="rejected"&&e.jsx(g,{title:"رفض",children:e.jsx(p,{color:"warning",size:"small",onClick:()=>T(s.id,"rejected"),children:e.jsx(J,{})})}),e.jsx(g,{title:"حذف نهائي",children:e.jsx(p,{color:"error",size:"small",onClick:()=>z(s.id,s.storagePath),children:e.jsx(K,{})})})]})})]},s.id)})})})]})}),e.jsx(te,{open:!!C,onClose:()=>f(null),maxWidth:"lg",children:e.jsxs(i,{sx:{position:"relative",p:1,bgcolor:"#000"},children:[e.jsx(p,{onClick:()=>f(null),sx:{position:"absolute",right:8,top:8,color:"#fff",bgcolor:"rgba(0,0,0,0.5)","&:hover":{bgcolor:"rgba(0,0,0,0.7)"}},children:e.jsx(Z,{})}),e.jsx("img",{src:C,alt:"Large preview",style:{maxWidth:"100%",maxHeight:"90vh",display:"block"}})]})})]})}export{ue as default};
