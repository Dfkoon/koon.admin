import{r as m,L as ge,M as je,N as be,_ as ye,F as y,j as t,O as $e,a as _e,Q as Ce,S as Re,U as c,V as ze,W as Be,i as $,b as _,s as Ie,p as R,u as E,q as te,w as H,e as V,d as N,f as p,X as De,Y as Me,J as G,x as Te,B as s,T as x,K as W,C as Ae,o as Le,P as Pe,t as O,I as q,z as D}from"./index-DiJP0-9s.js";import{d as ke,a as Ee}from"./Refresh-DCOeZUIP.js";import{d as He}from"./CheckCircle-C44imApy.js";import{d as ae}from"./Person-BavuKjIp.js";import{C as j}from"./Chip-BhGZD8wh.js";import{F as Oe}from"./Fab-BEsy00f2.js";import{T as Se,a as Ve,b as Ne,c as re,d as v,e as Ge}from"./TableRow-CA4P7yCv.js";function We(a){return m.Children.toArray(a).filter(e=>m.isValidElement(e))}function qe(a){return je("MuiButtonGroup",a)}const i=ge("MuiButtonGroup",["root","contained","outlined","text","disableElevation","disabled","firstButton","fullWidth","vertical","grouped","groupedHorizontal","groupedVertical","groupedText","groupedTextHorizontal","groupedTextVertical","groupedTextPrimary","groupedTextSecondary","groupedOutlined","groupedOutlinedHorizontal","groupedOutlinedVertical","groupedOutlinedPrimary","groupedOutlinedSecondary","groupedContained","groupedContainedHorizontal","groupedContainedVertical","groupedContainedPrimary","groupedContainedSecondary","lastButton","middleButton"]),Ue=["children","className","color","component","disabled","disableElevation","disableFocusRipple","disableRipple","fullWidth","orientation","size","variant"],Fe=(a,e)=>{const{ownerState:o}=a;return[{[`& .${i.grouped}`]:e.grouped},{[`& .${i.grouped}`]:e[`grouped${c(o.orientation)}`]},{[`& .${i.grouped}`]:e[`grouped${c(o.variant)}`]},{[`& .${i.grouped}`]:e[`grouped${c(o.variant)}${c(o.orientation)}`]},{[`& .${i.grouped}`]:e[`grouped${c(o.variant)}${c(o.color)}`]},{[`& .${i.firstButton}`]:e.firstButton},{[`& .${i.lastButton}`]:e.lastButton},{[`& .${i.middleButton}`]:e.middleButton},e.root,e[o.variant],o.disableElevation===!0&&e.disableElevation,o.fullWidth&&e.fullWidth,o.orientation==="vertical"&&e.vertical]},Qe=a=>{const{classes:e,color:o,disabled:u,disableElevation:C,fullWidth:z,orientation:d,variant:f}=a,g={root:["root",f,d==="vertical"&&"vertical",z&&"fullWidth",C&&"disableElevation"],grouped:["grouped",`grouped${c(d)}`,`grouped${c(f)}`,`grouped${c(f)}${c(d)}`,`grouped${c(f)}${c(o)}`,u&&"disabled"],firstButton:["firstButton"],lastButton:["lastButton"],middleButton:["middleButton"]};return ze(g,qe,e)},Xe=$e("div",{name:"MuiButtonGroup",slot:"Root",overridesResolver:Fe})(({theme:a,ownerState:e})=>y({display:"inline-flex",borderRadius:(a.vars||a).shape.borderRadius},e.variant==="contained"&&{boxShadow:(a.vars||a).shadows[2]},e.disableElevation&&{boxShadow:"none"},e.fullWidth&&{width:"100%"},e.orientation==="vertical"&&{flexDirection:"column"},{[`& .${i.grouped}`]:y({minWidth:40,"&:hover":y({},e.variant==="contained"&&{boxShadow:"none"})},e.variant==="contained"&&{boxShadow:"none"}),[`& .${i.firstButton},& .${i.middleButton}`]:y({},e.orientation==="horizontal"&&{borderTopRightRadius:0,borderBottomRightRadius:0},e.orientation==="vertical"&&{borderBottomRightRadius:0,borderBottomLeftRadius:0},e.variant==="text"&&e.orientation==="horizontal"&&{borderRight:a.vars?`1px solid rgba(${a.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${a.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${i.disabled}`]:{borderRight:`1px solid ${(a.vars||a).palette.action.disabled}`}},e.variant==="text"&&e.orientation==="vertical"&&{borderBottom:a.vars?`1px solid rgba(${a.vars.palette.common.onBackgroundChannel} / 0.23)`:`1px solid ${a.palette.mode==="light"?"rgba(0, 0, 0, 0.23)":"rgba(255, 255, 255, 0.23)"}`,[`&.${i.disabled}`]:{borderBottom:`1px solid ${(a.vars||a).palette.action.disabled}`}},e.variant==="text"&&e.color!=="inherit"&&{borderColor:a.vars?`rgba(${a.vars.palette[e.color].mainChannel} / 0.5)`:Be(a.palette[e.color].main,.5)},e.variant==="outlined"&&e.orientation==="horizontal"&&{borderRightColor:"transparent"},e.variant==="outlined"&&e.orientation==="vertical"&&{borderBottomColor:"transparent"},e.variant==="contained"&&e.orientation==="horizontal"&&{borderRight:`1px solid ${(a.vars||a).palette.grey[400]}`,[`&.${i.disabled}`]:{borderRight:`1px solid ${(a.vars||a).palette.action.disabled}`}},e.variant==="contained"&&e.orientation==="vertical"&&{borderBottom:`1px solid ${(a.vars||a).palette.grey[400]}`,[`&.${i.disabled}`]:{borderBottom:`1px solid ${(a.vars||a).palette.action.disabled}`}},e.variant==="contained"&&e.color!=="inherit"&&{borderColor:(a.vars||a).palette[e.color].dark},{"&:hover":y({},e.variant==="outlined"&&e.orientation==="horizontal"&&{borderRightColor:"currentColor"},e.variant==="outlined"&&e.orientation==="vertical"&&{borderBottomColor:"currentColor"})}),[`& .${i.lastButton},& .${i.middleButton}`]:y({},e.orientation==="horizontal"&&{borderTopLeftRadius:0,borderBottomLeftRadius:0},e.orientation==="vertical"&&{borderTopRightRadius:0,borderTopLeftRadius:0},e.variant==="outlined"&&e.orientation==="horizontal"&&{marginLeft:-1},e.variant==="outlined"&&e.orientation==="vertical"&&{marginTop:-1})})),Je=m.forwardRef(function(e,o){const u=be({props:e,name:"MuiButtonGroup"}),{children:C,className:z,color:d="primary",component:f="div",disabled:g=!1,disableElevation:B=!1,disableFocusRipple:T=!1,disableRipple:A=!1,fullWidth:L=!1,orientation:S="horizontal",size:I="medium",variant:r="outlined"}=u,l=ye(u,Ue),n=y({},u,{color:d,component:f,disabled:g,disableElevation:B,disableFocusRipple:T,disableRipple:A,fullWidth:L,orientation:S,size:I,variant:r}),h=Qe(n),fe=m.useMemo(()=>({className:h.grouped,color:d,disabled:g,disableElevation:B,disableFocusRipple:T,disableRipple:A,fullWidth:L,size:I,variant:r}),[d,g,B,T,A,L,I,r,h.grouped]),w=We(C),he=w.length,me=k=>{const P=k===0,ee=k===he-1;return P&&ee?"":P?h.firstButton:ee?h.lastButton:h.middleButton};return t.jsx(Xe,y({as:f,role:"group",className:_e(h.root,z),ref:o,ownerState:n},l,{children:t.jsx(Ce.Provider,{value:fe,children:w.map((k,P)=>t.jsx(Re.Provider,{value:me(P),children:k},P))})}))});var U={},Ke=$;Object.defineProperty(U,"__esModule",{value:!0});var ne=U.default=void 0,Ye=Ke(_()),Ze=t;ne=U.default=(0,Ye.default)((0,Ze.jsx)("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile");var F={},we=$;Object.defineProperty(F,"__esModule",{value:!0});var le=F.default=void 0,et=we(_()),tt=t;le=F.default=(0,et.default)((0,tt.jsx)("path",{d:"M6.99 11 3 15l3.99 4v-3H14v-2H6.99zM21 9l-3.99-4v3H10v2h7.01v3z"}),"SwapHoriz");var Q={},at=$;Object.defineProperty(Q,"__esModule",{value:!0});var de=Q.default=void 0,rt=at(_()),ot=t;de=Q.default=(0,rt.default)((0,ot.jsx)("path",{d:"M1 11h4v11H1zm15-7.75C16.65 2.49 17.66 2 18.7 2 20.55 2 22 3.45 22 5.3c0 2.27-2.91 4.9-6 7.7-3.09-2.81-6-5.44-6-7.7C10 3.45 11.45 2 13.3 2c1.04 0 2.05.49 2.7 1.25M20 17h-7l-2.09-.73.33-.94L13 16h2.82c.65 0 1.18-.53 1.18-1.18 0-.49-.31-.93-.77-1.11L8.97 11H7v9.02L14 22l8.01-3c-.01-1.1-.9-2-2.01-2"}),"VolunteerActivism");var X={},st=$;Object.defineProperty(X,"__esModule",{value:!0});var ce=X.default=void 0,it=st(_()),oe=t;ce=X.default=(0,it.default)([(0,oe.jsx)("circle",{cx:"12",cy:"19",r:"2"},"0"),(0,oe.jsx)("path",{d:"M10 3h4v12h-4z"},"1")],"PriorityHigh");var J={},nt=$;Object.defineProperty(J,"__esModule",{value:!0});var ue=J.default=void 0,lt=nt(_()),dt=t;ue=J.default=(0,lt.default)((0,dt.jsx)("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-6h2zm0-8h-2V7h2z"}),"Info");var K={},ct=$;Object.defineProperty(K,"__esModule",{value:!0});var pe=K.default=void 0,ut=ct(_()),pt=t;pe=K.default=(0,ut.default)((0,pt.jsx)("path",{d:"M22 3H2C.9 3 0 3.9 0 5v14c0 1.1.9 2 2 2h20c1.1 0 1.99-.9 1.99-2L24 5c0-1.1-.9-2-2-2M8 6c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3m6 12H2v-1c0-2 4-3.1 6-3.1s6 1.1 6 3.1zm3.85-4h1.64L21 16l-1.99 1.99c-1.31-.98-2.28-2.38-2.73-3.99-.18-.64-.28-1.31-.28-2s.1-1.36.28-2c.45-1.62 1.42-3.01 2.73-3.99L21 8l-1.51 2h-1.64c-.22.63-.35 1.3-.35 2s.13 1.37.35 2"}),"ContactPhone");var Y={},xt=$;Object.defineProperty(Y,"__esModule",{value:!0});var xe=Y.default=void 0,vt=xt(_()),ft=t;xe=Y.default=(0,vt.default)((0,ft.jsx)("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m4 12h-4v3l-5-5 5-5v3h4z"}),"AssignmentReturn");var Z={},ht=$;Object.defineProperty(Z,"__esModule",{value:!0});var ve=Z.default=void 0,mt=ht(_()),gt=t;ve=Z.default=(0,mt.default)((0,gt.jsx)("path",{d:"M12 1 3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5zm-2 16-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9z"}),"VerifiedUser");const b="materialDonations",se="settings",ie="material_exchange",M={async getSystemStatus(){const a=R(p,se,ie),e=await Me(a);return e.exists()?e.data():{phase:"donation",isActive:!0}},async setSystemPhase(a){const e=R(p,se,ie);await De(e,{phase:a,lastUpdated:G()},{merge:!0})},async getAllMaterials(){try{return(await N(V(p,b))).docs.map(e=>{var o,u;return{id:e.id,...e.data(),createdAt:(o=e.data().createdAt)!=null&&o.toDate?e.data().createdAt.toDate():(u=e.data().timestamp)!=null&&u.toDate?e.data().timestamp.toDate():e.data().createdAt?new Date(e.data().createdAt):new Date}}).sort((e,o)=>o.createdAt-e.createdAt)}catch(a){return console.error("Error fetching materials:",a),[]}},async updateReservation(a,e){const o=R(p,b,a);await E(o,{status:"reserved",takerInfo:e,reservedAt:G()})},async markAsHandedOver(a){const e=R(p,b,a);await E(e,{status:"completed",handedOverAt:G()})},async resetStatus(a){const e=R(p,b,a);await E(e,{status:"approved",takerInfo:null,reservedAt:null})},async checkUserDonations(a){const e=te(V(p,b),H("studentId","==",a),H("status","in",["approved","completed","reserved"]));return(await N(e)).size>0},async checkUserQuota(a){const e=te(V(p,b),H("takerInfo.studentId","==",a),H("status","in",["reserved","completed"]));return(await N(e)).size},async approveDonation(a){const e=R(p,b,a);await E(e,{status:"approved"})},async deleteMaterial(a){await Ie(R(p,b,a))}};function zt(){Te();const[a,e]=m.useState([]),[o,u]=m.useState(!0),[C,z]=m.useState({phase:"donation"}),[d,f]=m.useState("all"),g=async()=>{u(!0);try{const[r,l]=await Promise.all([M.getAllMaterials(),M.getSystemStatus()]);e(r),z(l)}catch{D.error("حدث خطأ أثناء تحميل البيانات")}u(!1)};m.useEffect(()=>{g()},[]);const B=async r=>{try{await M.setSystemPhase(r),z(l=>({...l,phase:r})),D.success(`تم تفعيل فترة: ${r==="donation"?"جمع المواد":"التبادل والاستلام"}`)}catch{D.error("فشل تغيير الفترة")}},T=async r=>{window.confirm("هل تم تسليم المادة للطالب؟")&&(await M.markAsHandedOver(r),e(l=>l.map(n=>n.id===r?{...n,status:"completed"}:n)),D.success("تم إتمام التسليم"))},A=async r=>{await M.approveDonation(r),e(l=>l.map(n=>n.id===r?{...n,status:"approved"}:n)),D.success("تمت الموافقة على العرض")},L=async r=>{window.confirm("هل أنت متأكد من الحذف؟")&&(await M.deleteMaterial(r),D.success("تم الحذف"),e(l=>l.filter(n=>n.id!==r)))},S=r=>{switch(r.status){case"pending":return t.jsx(j,{label:"قيد المراجعة",color:"warning",size:"small"});case"approved":return t.jsx(j,{label:"متوفر",color:"success",size:"small",variant:"outlined"});case"reserved":return t.jsx(j,{label:"محجوز",color:"info",size:"small"});case"completed":return t.jsx(j,{label:"تم التسليم",color:"default",size:"small"});default:return t.jsx(j,{label:"متاح",size:"small"})}},I=a.filter(r=>d==="all"?!0:d==="reserved"?r.status==="reserved":d==="completed"?r.status==="completed":d==="pending"?r.status==="pending":!0);return t.jsxs(s,{children:[t.jsxs(s,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"flex-start",flexWrap:"wrap",gap:2},children:[t.jsxs(s,{children:[t.jsx(x,{variant:"h4",fontWeight:"bold",gutterBottom:!0,children:"تبادل المواد الدراسية"}),t.jsx(x,{variant:"body2",color:"text.secondary",children:"إدارة عملية التبرع واستلام المواد بين الطلاب"})]}),t.jsxs(s,{sx:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:1},children:[t.jsxs(Je,{variant:"contained",size:"small",children:[t.jsx(W,{color:C.phase==="donation"?"primary":"inherit",onClick:()=>B("donation"),startIcon:t.jsx(de,{}),children:"فترة التبرع"}),t.jsx(W,{color:C.phase==="exchange"?"primary":"inherit",onClick:()=>B("exchange"),startIcon:t.jsx(le,{}),children:"فترة الاستلام"})]}),t.jsx(j,{label:C.phase==="donation"?"الحالة الحالية: جمع مواد":"الحالة الحالية: تبادل نشط",size:"small",sx:{bgcolor:"rgba(255,255,255,0.05)",color:"text.secondary"}})]})]}),t.jsxs(s,{sx:{mb:3,display:"flex",gap:1},children:[["all","pending","reserved","completed"].map(r=>t.jsx(W,{variant:d===r?"contained":"outlined",size:"small",onClick:()=>f(r),sx:{borderRadius:2},children:r==="all"?"الكل":r==="pending"?"بانتظار الموافقة":r==="reserved"?"المحجوزة":"المسلمة"},r)),t.jsx(s,{sx:{flexGrow:1}}),t.jsx(Oe,{color:"primary",size:"small",onClick:g,children:t.jsx(ke,{})})]}),o?t.jsx(s,{display:"flex",justifyContent:"center",mt:10,children:t.jsx(Ae,{})}):t.jsxs(Le.div,{initial:{opacity:0},animate:{opacity:1},children:[t.jsx(Se,{component:Pe,className:"glass-panel",sx:{background:"transparent",boxShadow:"none"},children:t.jsxs(Ve,{sx:{minWidth:800},children:[t.jsx(Ne,{children:t.jsxs(re,{children:[t.jsx(v,{sx:{color:"text.secondary"},children:"المادة"}),t.jsx(v,{sx:{color:"text.secondary"},children:"المتبرع"}),t.jsx(v,{sx:{color:"text.secondary"},children:"الحاصل عليها (المستلم)"}),t.jsx(v,{sx:{color:"text.secondary"},children:"الحالة والأولوية"}),t.jsx(v,{sx:{color:"text.secondary"},children:"إجراءات"})]})}),t.jsx(Ge,{children:I.map((r,l)=>{var n,h;return t.jsxs(re,{sx:{bgcolor:l%2===0?"rgba(255,255,255,0.02)":"transparent","&:hover":{bgcolor:"rgba(211, 47, 47, 0.05)"},transition:"0.2s"},children:[t.jsx(v,{children:t.jsxs(s,{children:[t.jsxs(s,{display:"flex",alignItems:"center",gap:1,children:[t.jsx(ne,{color:"primary",fontSize:"small"}),t.jsx(x,{fontWeight:"bold",children:r.itemName||r.materials&&r.materials[0]||"مادة دراسية"})]}),t.jsx(x,{variant:"caption",color:"text.secondary",children:new Date(r.createdAt).toLocaleDateString()}),((n=r.materials)==null?void 0:n.length)>1&&t.jsx(s,{mt:.5,children:t.jsx(j,{label:`+${r.materials.length-1} مواد أخرى`,size:"mini",sx:{fontSize:"10px",height:16}})})]})}),t.jsx(v,{children:t.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:.2},children:[t.jsxs(s,{display:"flex",alignItems:"center",gap:.5,children:[t.jsx(ae,{sx:{fontSize:14,color:"primary.main"}}),t.jsx(x,{variant:"body2",children:r.studentName||"غير معروف"})]}),t.jsxs(s,{display:"flex",alignItems:"center",gap:.5,children:[t.jsx(pe,{sx:{fontSize:14,color:"text.secondary"}}),t.jsx(x,{variant:"caption",color:"text.secondary",children:r.phoneNumber||r.contactInfo})]})]})}),t.jsx(v,{children:r.takerInfo?t.jsxs(s,{sx:{display:"flex",flexDirection:"column",gap:.2},children:[t.jsxs(s,{display:"flex",alignItems:"center",gap:.5,children:[t.jsx(ae,{sx:{fontSize:14,color:"info.main"}}),t.jsx(x,{variant:"body2",children:r.takerInfo.name})]}),t.jsx(x,{variant:"caption",color:"text.secondary",children:r.takerInfo.phone}),r.takerInfo.isDonor&&t.jsx(j,{label:"له أولوية (متبرع)",size:"small",color:"success",icon:t.jsx(ve,{sx:{fontSize:"12px !important"}}),sx:{height:20,fontSize:"10px",mt:.5}})]}):t.jsx(x,{variant:"caption",color:"text.disabled",children:"لم تحجز بعد"})}),t.jsx(v,{children:t.jsxs(s,{display:"flex",alignItems:"center",gap:1,children:[S(r),r.status==="reserved"&&!((h=r.takerInfo)!=null&&h.isDonor)&&t.jsx(O,{title:"يمكن للمتبرعين أخذ أولوية على هذا الحجز",children:t.jsx(ce,{color:"warning",sx:{fontSize:16}})})]})}),t.jsx(v,{children:t.jsxs(s,{display:"flex",gap:.5,children:[r.status==="pending"&&t.jsx(O,{title:"موافقة",children:t.jsx(q,{color:"success",size:"small",onClick:()=>A(r.id),children:t.jsx(He,{})})}),r.status==="reserved"&&t.jsx(O,{title:"تسليم",children:t.jsx(q,{color:"info",size:"small",onClick:()=>T(r.id),children:t.jsx(xe,{})})}),t.jsx(O,{title:"حذف",children:t.jsx(q,{color:"error",size:"small",onClick:()=>L(r.id),children:t.jsx(Ee,{})})})]})})]},r.id)})})]})}),I.length===0&&t.jsxs(s,{textAlign:"center",py:10,color:"text.secondary",children:[t.jsx(ue,{sx:{fontSize:40,mb:1,opacity:.3}}),t.jsx(x,{children:"لا توجد بيانات تطابق هذا الفلتر حالياً"})]})]})]})}export{zt as default};
