import{c as I,j as e,u as q,i as A,k as R,d as P,e as C,f as u,r as j,B as i,T as c,I as f,C as B,A as W,m as k,l as v,V as E,n as L,z}from"./index-DDxPDUZw.js";import{R as M,C as p,D as T}from"./Refresh-BRaLqE8u.js";import{P as V,A as $}from"./Person-BdaH_FTh.js";import{M as H}from"./Message-BKuXqIbp.js";const N=I(e.jsx("path",{d:"M10 9V5l-7 7 7 7v-4.1c5 0 8.5 1.6 11 5.1-1-5-4-10-11-11"}),"Reply"),w={async getAllSuggestions(){try{const l=(await P(C(u,"qna"))).docs.map(a=>({id:a.id,source:"qna",...a.data(),text:a.data().message||a.data().text||a.data().content||a.data().quote||""})),g=(await P(C(u,"suggestions"))).docs.map(a=>({id:a.id,source:"suggestions",...a.data(),text:a.data().message||a.data().text||a.data().content||a.data().quote||""}));return[...l,...g].sort((a,x)=>{var s,t;const y=(s=a.createdAt)!=null&&s.toDate?a.createdAt.toDate():new Date(a.createdAt);return((t=x.createdAt)!=null&&t.toDate?x.createdAt.toDate():new Date(x.createdAt))-y})}catch(n){return console.error("Error fetching suggestions:",n),[]}},async deleteSuggestion(n,l="qna"){await R(A(u,l,n))},async togglePublicStatus(n,l,h="qna"){await q(A(u,h,n),{isPublic:l})}};function G(){const[n,l]=j.useState([]),[h,g]=j.useState(!0),[d,a]=j.useState(null),x=async()=>{g(!0);const t=await w.getAllSuggestions();l(t),g(!1)};j.useEffect(()=>{x()},[]);const y=async(t,o,r)=>{t.stopPropagation(),window.confirm("هل أنت متأكد من الحذف؟")&&(await w.deleteSuggestion(o,r),z.success("تم الحذف بنجاح"),l(b=>b.filter(m=>m.id!==o)),d===o&&a(null))},D=async(t,o,r,b)=>{t.stopPropagation(),await w.togglePublicStatus(o,!r,b),z.success(r?"تم الإخفاء":"تم النشر"),l(m=>m.map(S=>S.id===o?{...S,isPublic:!r}:S))},s=n.find(t=>t.id===d);return e.jsxs(i,{sx:{height:"calc(100vh - 100px)",display:"flex",gap:3},children:[e.jsxs(i,{className:"glass-panel",sx:{width:{xs:"100%",md:"350px"},display:"flex",flexDirection:"column",overflow:"hidden"},children:[e.jsxs(i,{sx:{p:2,display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid var(--glass-border)"},children:[e.jsx(c,{variant:"h6",fontWeight:"bold",children:"البريد الوارد"}),e.jsx(f,{size:"small",onClick:x,children:e.jsx(M,{})})]}),e.jsx(i,{sx:{flex:1,overflowY:"auto",p:2},children:h?e.jsx(i,{display:"flex",justifyContent:"center",mt:4,children:e.jsx(B,{size:30})}):e.jsx(W,{children:n.map((t,o)=>{var r;return e.jsx(k.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:o*.05},onClick:()=>a(t.id),children:e.jsxs(i,{sx:{p:2,mb:1.5,borderRadius:"16px",background:d===t.id?"rgba(211, 47, 47, 0.15)":"rgba(255,255,255,0.03)",border:d===t.id?"1px solid var(--primary)":"1px solid transparent",cursor:"pointer","&:hover":{background:"rgba(255,255,255,0.05)"}},children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",mb:1,children:[e.jsx(c,{variant:"subtitle2",fontWeight:"bold",children:t.name||"مجهول"}),e.jsx(c,{variant:"caption",color:"text.secondary",children:(r=t.createdAt)!=null&&r.toDate?t.createdAt.toDate().toLocaleDateString():new Date(t.createdAt).toLocaleDateString()})]}),e.jsx(c,{variant:"body2",color:"text.secondary",noWrap:!0,children:t.text}),e.jsxs(i,{mt:1,display:"flex",gap:1,children:[e.jsx(p,{label:t.type||"عام",size:"small",sx:{height:20,fontSize:"0.7rem",bgcolor:t.type==="complaint"?"error.dark":"primary.dark"}}),t.isPublic&&e.jsx(p,{label:"منشور",size:"small",color:"success",sx:{height:20,fontSize:"0.7rem"}})]})]})},t.id)})})})]}),e.jsx(i,{className:"glass-panel",sx:{flex:1,p:4,display:{xs:d?"block":"none",md:"block"},position:"relative"},children:s?e.jsxs(k.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"flex-start",mb:4,children:[e.jsxs(i,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(i,{sx:{width:50,height:50,borderRadius:"50%",bgcolor:"rgba(255,255,255,0.1)",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(V,{fontSize:"large",color:"primary"})}),e.jsxs(i,{children:[e.jsx(c,{variant:"h5",fontWeight:"bold",children:s.name||"فاعل خير"}),e.jsxs(i,{display:"flex",alignItems:"center",gap:1,children:[e.jsx($,{fontSize:"small",sx:{color:"text.secondary",fontSize:16}}),e.jsx(c,{variant:"body2",color:"text.secondary",children:new Date(s.createdAt).toLocaleString()})]})]})]}),e.jsxs(i,{display:"flex",gap:1,children:[e.jsx(v,{title:s.isPublic?"إخفاء":"نشر",children:e.jsx(f,{onClick:t=>D(t,s.id,s.isPublic,s.source),color:s.isPublic?"success":"default",children:s.isPublic?e.jsx(E,{}):e.jsx(L,{})})}),e.jsx(v,{title:"رد (WhatsApp)",children:e.jsx(f,{color:"primary",onClick:()=>window.open(`https://wa.me/?text=رد على رسالتك: ${s.text}`,"_blank"),children:e.jsx(N,{})})}),e.jsx(v,{title:"حذف",children:e.jsx(f,{color:"error",onClick:t=>y(t,s.id,s.source),children:e.jsx(T,{})})})]})]}),e.jsx(Paper,{elevation:0,sx:{p:3,bgcolor:"rgba(0,0,0,0.3)",borderRadius:"20px",border:"1px solid rgba(255,255,255,0.05)",minHeight:"200px"},children:e.jsxs(c,{variant:"h6",sx:{lineHeight:1.8},children:['"',s.text,'"']})}),e.jsxs(i,{mt:3,display:"flex",gap:2,flexWrap:"wrap",children:[s.email&&e.jsx(p,{label:`Email: ${s.email}`,variant:"outlined"}),s.phone&&e.jsx(p,{label:`Phone: ${s.phone}`,variant:"outlined"}),e.jsx(p,{label:`Source: ${s.source}`,variant:"outlined",color:"primary"})]})]},s.id):e.jsxs(i,{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100%",color:"text.secondary",children:[e.jsx(H,{sx:{fontSize:80,opacity:.2,mb:2}}),e.jsx(c,{variant:"h6",children:"اختر رسالة لعرض التفاصيل"})]})})]})}export{G as default};
