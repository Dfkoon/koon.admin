import{c as A,j as s,k as R,i as f,u as w,q as D,e as I,f as d,J as S,d as z,r as x,B as t,T as r,I as p,C as q,h as E,A as L,m as N,l as g,z as y}from"./index-BkniLVl-.js";import{R as T,C as k,D as B}from"./Refresh-DkUl10bN.js";import{G as b}from"./Grid-BSClNp5Q.js";import{P as H,A as P}from"./Person-BLB-_C6c.js";import{C as G}from"./CheckCircle-BnFsqlJl.js";const M=A(s.jsx("path",{d:"M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1m2 14H7v-2h7zm3-4H7v-2h10zm0-4H7V7h10z"}),"Assignment"),h="question_reports",m={async getAllReports(){try{const a=D(I(d,h),S("createdAt","desc"));return(await z(a)).docs.map(i=>({id:i.id,...i.data()}))}catch(a){return console.error("Error fetching question reports:",a),[]}},async updateStatus(a,n){const i=f(d,h,a);await w(i,{status:n,updatedAt:new Date})},async deleteReport(a){await R(f(d,h,a))}};function Q(){const[a,n]=x.useState([]),[i,u]=x.useState(!0),j=async()=>{u(!0);const e=await m.getAllReports();n(e),u(!1)};x.useEffect(()=>{j()},[]);const v=async(e,c)=>{await m.updateStatus(e,c),y.success("تم حل المشكلة"),n(o=>o.map(l=>l.id===e?{...l,status:c}:l))},C=async e=>{window.confirm("هل أنت متأكد من الحذف؟")&&(await m.deleteReport(e),y.success("تم الحذف"),n(c=>c.filter(o=>o.id!==e)))};return s.jsxs(t,{children:[s.jsxs(t,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(r,{variant:"h4",fontWeight:"bold",children:"مراجعة أسئلة الاختبارات"}),s.jsx(p,{color:"primary",onClick:j,className:"glass-panel",sx:{p:1.5},children:s.jsx(T,{})})]}),i?s.jsx(t,{display:"flex",justifyContent:"center",height:"50vh",alignItems:"center",children:s.jsx(q,{})}):a.length===0?s.jsxs(t,{sx:{textAlign:"center",mt:10,opacity:.5},children:[s.jsx(E,{sx:{fontSize:100,mb:2}}),s.jsx(r,{variant:"h6",children:"لا توجد تقارير حالياً"})]}):s.jsx(b,{container:!0,spacing:3,children:s.jsx(L,{children:a.map((e,c)=>{var o;return s.jsx(b,{item:!0,xs:12,md:6,children:s.jsx(N.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:c*.05},children:s.jsxs(t,{className:"glass-panel",sx:{p:3,position:"relative"},children:[s.jsxs(t,{display:"flex",justifyContent:"space-between",mb:2,children:[s.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[s.jsx(M,{color:"primary"}),s.jsxs(r,{variant:"subtitle1",fontWeight:"bold",children:["سؤال #",e.questionId||"غير معروف"]})]}),s.jsx(k,{label:e.status==="resolved"?"تم الحل":"قيد المراجعة",color:e.status==="resolved"?"success":"warning",size:"small"})]}),s.jsx(r,{variant:"body1",sx:{mb:2,bgcolor:"rgba(0,0,0,0.2)",p:2,borderRadius:2},children:e.comment||e.text||"لا يوجد تعليق"}),s.jsxs(t,{display:"flex",flexDirection:"column",gap:1,mb:2,children:[s.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[s.jsx(H,{fontSize:"small",color:"disabled"}),s.jsxs(r,{variant:"caption",color:"text.secondary",children:["الطالب: ",e.studentName||"مجهول"," (",e.studentId||"N/A",")"]})]}),s.jsxs(t,{display:"flex",alignItems:"center",gap:1,children:[s.jsx(P,{fontSize:"small",color:"disabled"}),s.jsxs(r,{variant:"caption",color:"text.secondary",children:["التاريخ: ",(o=e.createdAt)!=null&&o.toDate?e.createdAt.toDate().toLocaleString():new Date(e.createdAt).toLocaleString()]})]})]}),s.jsxs(t,{display:"flex",justifyContent:"flex-end",gap:1,pt:2,borderTop:"1px solid rgba(255,255,255,0.05)",children:[e.status!=="resolved"&&s.jsx(g,{title:"تم الحل",children:s.jsx(p,{color:"success",onClick:()=>v(e.id,"resolved"),children:s.jsx(G,{})})}),s.jsx(g,{title:"حذف",children:s.jsx(p,{color:"error",onClick:()=>C(e.id),children:s.jsx(B,{})})})]})]})})},e.id)})})})]})}export{Q as default};
