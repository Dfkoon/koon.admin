import{c as C,j as s,k as T,i as v,u as w,d as A,e as I,f as p,s as z,r as x,B as i,T as c,C as k,A as E,m as S,l as h,I as j,z as g}from"./index-DDxPDUZw.js";import{F as L}from"./Fab-D3SpC3Yt.js";import{R as F,C as R,D as B}from"./Refresh-BRaLqE8u.js";import{G as b}from"./Grid-DsdfCoG1.js";import{C as M}from"./CheckCircle-BRprjn7U.js";const N=C(s.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12z"}),"Cancel"),G=C(s.jsx("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"}),"FormatQuote"),u="testimonials",m={async getAllTestimonials(){try{return(await A(I(p,u))).docs.map(a=>{var o;return{id:a.id,...a.data(),date:(o=a.data().createdAt)!=null&&o.toDate?a.data().createdAt.toDate():new Date(a.data().createdAt||Date.now())}}).sort((a,o)=>o.date-a.date)}catch(t){return console.error("Error fetching testimonials:",t),[]}},async updateStatus(t,a){const o=v(p,u,t),n={status:a,approved:a==="approved"};a==="approved"&&(n.approvedAt=z()),await w(o,n)},async deleteTestimonial(t){await T(v(p,u,t))}};function W(){const[t,a]=x.useState([]),[o,n]=x.useState(!0),f=async()=>{n(!0);const e=await m.getAllTestimonials();a(e),n(!1)};x.useEffect(()=>{f()},[]);const y=async(e,r)=>{await m.updateStatus(e,r),g.success(r==="approved"?"تمت الموافقة":"تم الرفض"),a(l=>l.map(d=>d.id===e?{...d,status:r,approved:r==="approved"}:d))},D=async e=>{window.confirm("هل أنت متأكد من الحذف؟")&&(await m.deleteTestimonial(e),g.success("تم الحذف"),a(r=>r.filter(l=>l.id!==e)))};return s.jsxs(i,{children:[s.jsxs(i,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(c,{variant:"h4",fontWeight:"bold",children:"إدارة آراء الطلاب"}),s.jsx(L,{color:"primary",size:"small",onClick:f,children:s.jsx(F,{})})]}),o?s.jsx(i,{display:"flex",justifyContent:"center",height:"50vh",alignItems:"center",children:s.jsx(k,{})}):s.jsx(b,{container:!0,spacing:3,children:s.jsx(E,{children:t.map((e,r)=>s.jsx(b,{item:!0,xs:12,sm:6,md:4,children:s.jsx(S.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:r*.05},children:s.jsxs(i,{className:"glass-card",sx:{p:3,height:"100%",position:"relative",border:e.approved?"1px solid var(--success)":"1px solid var(--glass-border)",boxShadow:e.approved?"0 0 15px rgba(0, 230, 118, 0.1)":"none"},children:[s.jsx(G,{sx:{fontSize:40,color:"var(--primary)",opacity:.3,position:"absolute",top:10,left:10}}),s.jsxs(i,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(c,{variant:"h6",fontWeight:"bold",children:e.name}),s.jsx(R,{label:e.status==="approved"?"معتمد":e.status==="rejected"?"مرفوض":"قيد الانتظار",color:e.status==="approved"?"success":e.status==="rejected"?"error":"warning",size:"small"})]}),s.jsxs(c,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[e.major," - السنة ",e.year]}),s.jsxs(c,{variant:"body1",sx:{minHeight:80,mb:2,fontStyle:"italic",color:"rgba(255,255,255,0.9)"},children:['"',e.message,'"']}),s.jsxs(i,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:"auto",pt:2,borderTop:"1px solid rgba(255,255,255,0.05)"},children:[e.status!=="approved"&&s.jsx(h,{title:"اعتماد",children:s.jsx(j,{color:"success",onClick:()=>y(e.id,"approved"),children:s.jsx(M,{})})}),e.status!=="rejected"&&s.jsx(h,{title:"رفض",children:s.jsx(j,{color:"warning",onClick:()=>y(e.id,"rejected"),children:s.jsx(N,{})})}),s.jsx(h,{title:"حذف",children:s.jsx(j,{color:"error",onClick:()=>D(e.id),children:s.jsx(B,{})})})]})]})})},e.id))})})]})}export{W as default};
