import{r as d,o as C,p as T,t as j,_ as R,v as p,j as o,x as w,b as k,y as M,D as m,E as ae,F as oe,G as I,c as se,k as ne,i as h,u as z,q as F,w as A,e as _,d as P,f as u,H as re,J as le,s as E,B as f,T as ie,C as ce,m as de,P as pe,l as ue,I as ge,z as xe}from"./index-DDxPDUZw.js";import{F as ye}from"./Fab-D3SpC3Yt.js";import{R as be,C as ve,D as he}from"./Refresh-BRaLqE8u.js";const ee=d.createContext();function fe(e){return C("MuiTable",e)}T("MuiTable",["root","stickyHeader"]);const me=["className","component","padding","size","stickyHeader"],Ce=e=>{const{classes:t,stickyHeader:a}=e;return M({root:["root",a&&"stickyHeader"]},fe,t)},Te=w("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.stickyHeader&&t.stickyHeader]}})(({theme:e,ownerState:t})=>p({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":p({},e.typography.body2,{padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"})},t.stickyHeader&&{borderCollapse:"separate"})),q="table",je=d.forwardRef(function(t,a){const s=j({props:t,name:"MuiTable"}),{className:i,component:r=q,padding:n="normal",size:l="medium",stickyHeader:c=!1}=s,y=R(s,me),x=p({},s,{component:r,padding:n,size:l,stickyHeader:c}),H=Ce(x),U=d.useMemo(()=>({padding:n,size:l,stickyHeader:c}),[n,l,c]);return o.jsx(ee.Provider,{value:U,children:o.jsx(Te,p({as:r,role:r===q?null:"table",ref:a,className:k(H.root,i),ownerState:x},y))})}),S=d.createContext();function Re(e){return C("MuiTableBody",e)}T("MuiTableBody",["root"]);const we=["className","component"],ke=e=>{const{classes:t}=e;return M({root:["root"]},Re,t)},Me=w("tbody",{name:"MuiTableBody",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-row-group"}),He={variant:"body"},G="tbody",$e=d.forwardRef(function(t,a){const s=j({props:t,name:"MuiTableBody"}),{className:i,component:r=G}=s,n=R(s,we),l=p({},s,{component:r}),c=ke(l);return o.jsx(S.Provider,{value:He,children:o.jsx(Me,p({className:k(c.root,i),as:r,ref:a,role:r===G?null:"rowgroup",ownerState:l},n))})});function De(e){return C("MuiTableCell",e)}const Ne=T("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),ze=["align","className","component","padding","scope","size","sortDirection","variant"],Ae=e=>{const{classes:t,variant:a,align:s,padding:i,size:r,stickyHeader:n}=e,l={root:["root",a,n&&"stickyHeader",s!=="inherit"&&`align${m(s)}`,i!=="normal"&&`padding${m(i)}`,`size${m(r)}`]};return M(l,De,t)},Ie=w("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,t[a.variant],t[`size${m(a.size)}`],a.padding!=="normal"&&t[`padding${m(a.padding)}`],a.align!=="inherit"&&t[`align${m(a.align)}`],a.stickyHeader&&t.stickyHeader]}})(({theme:e,ownerState:t})=>p({},e.typography.body2,{display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?ae(I(e.palette.divider,1),.88):oe(I(e.palette.divider,1),.68)}`,textAlign:"left",padding:16},t.variant==="head"&&{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium},t.variant==="body"&&{color:(e.vars||e).palette.text.primary},t.variant==="footer"&&{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)},t.size==="small"&&{padding:"6px 16px",[`&.${Ne.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}},t.padding==="checkbox"&&{width:48,padding:"0 0 0 4px"},t.padding==="none"&&{padding:0},t.align==="left"&&{textAlign:"left"},t.align==="center"&&{textAlign:"center"},t.align==="right"&&{textAlign:"right",flexDirection:"row-reverse"},t.align==="justify"&&{textAlign:"justify"},t.stickyHeader&&{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default})),g=d.forwardRef(function(t,a){const s=j({props:t,name:"MuiTableCell"}),{align:i="inherit",className:r,component:n,padding:l,scope:c,size:y,sortDirection:x,variant:H}=s,U=R(s,ze),b=d.useContext(ee),D=d.useContext(S),B=D&&D.variant==="head";let $;n?$=n:$=B?"th":"td";let N=c;$==="td"?N=void 0:!N&&B&&(N="col");const O=H||D&&D.variant,L=p({},s,{align:i,component:$,padding:l||(b&&b.padding?b.padding:"normal"),size:y||(b&&b.size?b.size:"medium"),sortDirection:x,stickyHeader:O==="head"&&b&&b.stickyHeader,variant:O}),te=Ae(L);let W=null;return x&&(W=x==="asc"?"ascending":"descending"),o.jsx(Ie,p({as:$,ref:a,className:k(te.root,r),"aria-sort":W,scope:N,ownerState:L},U))});function Se(e){return C("MuiTableContainer",e)}T("MuiTableContainer",["root"]);const Ue=["className","component"],_e=e=>{const{classes:t}=e;return M({root:["root"]},Se,t)},Pe=w("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(e,t)=>t.root})({width:"100%",overflowX:"auto"}),Ee=d.forwardRef(function(t,a){const s=j({props:t,name:"MuiTableContainer"}),{className:i,component:r="div"}=s,n=R(s,Ue),l=p({},s,{component:r}),c=_e(l);return o.jsx(Pe,p({ref:a,as:r,className:k(c.root,i),ownerState:l},n))});function Be(e){return C("MuiTableHead",e)}T("MuiTableHead",["root"]);const Oe=["className","component"],Le=e=>{const{classes:t}=e;return M({root:["root"]},Be,t)},We=w("thead",{name:"MuiTableHead",slot:"Root",overridesResolver:(e,t)=>t.root})({display:"table-header-group"}),Fe={variant:"head"},J="thead",qe=d.forwardRef(function(t,a){const s=j({props:t,name:"MuiTableHead"}),{className:i,component:r=J}=s,n=R(s,Oe),l=p({},s,{component:r}),c=Le(l);return o.jsx(S.Provider,{value:Fe,children:o.jsx(We,p({as:r,className:k(c.root,i),ref:a,role:r===J?null:"rowgroup",ownerState:l},n))})});function Ge(e){return C("MuiTableRow",e)}const V=T("MuiTableRow",["root","selected","hover","head","footer"]),Je=["className","component","hover","selected"],Ve=e=>{const{classes:t,selected:a,hover:s,head:i,footer:r}=e;return M({root:["root",a&&"selected",s&&"hover",i&&"head",r&&"footer"]},Ge,t)},Xe=w("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:a}=e;return[t.root,a.head&&t.head,a.footer&&t.footer]}})(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${V.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${V.selected}`]:{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / ${e.vars.palette.action.selectedOpacity})`:I(e.palette.primary.main,e.palette.action.selectedOpacity),"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.primary.mainChannel} / calc(${e.vars.palette.action.selectedOpacity} + ${e.vars.palette.action.hoverOpacity}))`:I(e.palette.primary.main,e.palette.action.selectedOpacity+e.palette.action.hoverOpacity)}}})),X="tr",Q=d.forwardRef(function(t,a){const s=j({props:t,name:"MuiTableRow"}),{className:i,component:r=X,hover:n=!1,selected:l=!1}=s,c=R(s,Je),y=d.useContext(S),x=p({},s,{component:r,hover:n,selected:l,head:y&&y.variant==="head",footer:y&&y.variant==="footer"}),H=Ve(x);return o.jsx(Xe,p({as:r,ref:a,className:k(H.root,i),role:r===X?null:"row",ownerState:x},c))}),Qe=se(o.jsx("path",{d:"M6 2c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm7 7V3.5L18.5 9z"}),"InsertDriveFile"),v="materialDonations",K="settings",Y="material_exchange",Z={async getSystemStatus(){const e=h(u,K,Y),t=await le(e);return t.exists()?t.data():{phase:"donation",isActive:!0}},async setSystemPhase(e){const t=h(u,K,Y);await re(t,{phase:e,lastUpdated:E()},{merge:!0})},async getAllMaterials(){try{return(await P(_(u,v))).docs.map(t=>{var a,s;return{id:t.id,...t.data(),createdAt:(a=t.data().createdAt)!=null&&a.toDate?t.data().createdAt.toDate():(s=t.data().timestamp)!=null&&s.toDate?t.data().timestamp.toDate():t.data().createdAt?new Date(t.data().createdAt):new Date}}).sort((t,a)=>a.createdAt-t.createdAt)}catch(e){return console.error("Error fetching materials:",e),[]}},async updateReservation(e,t){const a=h(u,v,e);await z(a,{status:"reserved",takerInfo:t,reservedAt:E()})},async markAsHandedOver(e){const t=h(u,v,e);await z(t,{status:"completed",handedOverAt:E()})},async resetStatus(e){const t=h(u,v,e);await z(t,{status:"approved",takerInfo:null,reservedAt:null})},async checkUserDonations(e){const t=F(_(u,v),A("studentId","==",e),A("status","in",["approved","completed","reserved"]));return(await P(t)).size>0},async checkUserQuota(e){const t=F(_(u,v),A("takerInfo.studentId","==",e),A("status","in",["reserved","completed"]));return(await P(t)).size},async approveDonation(e){const t=h(u,v,e);await z(t,{status:"approved"})},async deleteMaterial(e){await ne(h(u,v,e))}};function et(){const[e,t]=d.useState([]),[a,s]=d.useState(!0),i=async()=>{s(!0);const n=await Z.getAllMaterials();t(n),s(!1)};d.useEffect(()=>{i()},[]);const r=async n=>{window.confirm("هل أنت متأكد من الحذف؟")&&(await Z.deleteMaterial(n),xe.success("تم الحذف"),t(l=>l.filter(c=>c.id!==n)))};return o.jsxs(f,{children:[o.jsxs(f,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[o.jsx(ie,{variant:"h4",fontWeight:"bold",children:"تبادل المواد"}),o.jsx(ye,{color:"primary",size:"small",onClick:i,children:o.jsx(be,{})})]}),a?o.jsx(f,{display:"flex",justifyContent:"center",mt:10,children:o.jsx(ce,{})}):o.jsxs(de.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},children:[o.jsx(Ee,{component:pe,className:"glass-panel",sx:{background:"transparent",boxShadow:"none"},children:o.jsxs(je,{sx:{minWidth:650},children:[o.jsx(qe,{children:o.jsxs(Q,{children:[o.jsx(g,{sx:{color:"text.secondary"},children:"اسم المادة"}),o.jsx(g,{sx:{color:"text.secondary"},children:"الوصف"}),o.jsx(g,{sx:{color:"text.secondary"},children:"معلومات التواصل"}),o.jsx(g,{sx:{color:"text.secondary"},children:"التاريخ"}),o.jsx(g,{sx:{color:"text.secondary"},children:"إجراءات"})]})}),o.jsx($e,{children:e.map((n,l)=>o.jsxs(Q,{sx:{"&:last-child td, &:last-child th":{border:0},bgcolor:l%2===0?"rgba(255,255,255,0.02)":"transparent","&:hover":{bgcolor:"rgba(211, 47, 47, 0.05)"}},children:[o.jsx(g,{component:"th",scope:"row",sx:{color:"white",fontWeight:"bold"},children:o.jsxs(f,{display:"flex",alignItems:"center",gap:2,children:[o.jsx(Qe,{color:"primary"}),n.itemName]})}),o.jsx(g,{sx:{color:"rgba(255,255,255,0.7)"},children:n.description||"لا يوجد وصف"}),o.jsx(g,{children:o.jsx(f,{display:"flex",flexDirection:"column",gap:.5,children:n.contactInfo&&o.jsx(ve,{label:n.contactInfo,size:"small",variant:"outlined",sx:{color:"white",borderColor:"rgba(255,255,255,0.2)"}})})}),o.jsx(g,{sx:{color:"rgba(255,255,255,0.7)"},children:new Date(n.createdAt).toLocaleDateString()}),o.jsx(g,{children:o.jsx(ue,{title:"حذف",children:o.jsx(ge,{color:"error",onClick:()=>r(n.id),children:o.jsx(he,{})})})})]},n.id))})]})}),e.length===0&&o.jsx(f,{textAlign:"center",py:5,color:"text.secondary",children:"لا توجد مواد مضافة حالياً"})]})]})}export{et as default};
