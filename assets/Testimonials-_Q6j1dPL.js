import{r as h,x as X,y as ee,_ as te,D as se,E as re,j as e,F as R,G as O,H as ae,i as oe,b as ne,s as ie,p as $,u as le,d as de,e as ce,f as S,J as pe,B as x,T as f,C as xe,A as ue,o as fe,t as z,I as w,K as P,z as A}from"./index-DiJP0-9s.js";import{d as B}from"./CheckCircle-C44imApy.js";import{d as he,a as me}from"./Close-VJPl8f65.js";import{d as je,a as G}from"./Refresh-DCOeZUIP.js";import{F as ge}from"./Fab-BEsy00f2.js";import{G as q}from"./Grid-Cqdxh33Y.js";import{C as H}from"./Chip-BhGZD8wh.js";import{D as ve}from"./Dialog--eHXLavO.js";import{D as ye,a as be,b as Ee}from"./DialogTitle-DMgumv3i.js";const Ce=["addEndListener","appear","children","easing","in","onEnter","onEntered","onEntering","onExit","onExited","onExiting","style","timeout","TransitionComponent"],De={entering:{transform:"none"},entered:{transform:"none"}},Te=h.forwardRef(function(a,l){const n=X(),s={enter:n.transitions.duration.enteringScreen,exit:n.transitions.duration.leavingScreen},{addEndListener:g,appear:k=!0,children:u,easing:v,in:m,onEnter:y,onEntered:_,onEntering:D,onExit:b,onExited:t,onExiting:i,style:r,timeout:c=s,TransitionComponent:E=ee}=a,M=te(a,Ce),T=h.useRef(null),N=se(T,re(u),l),j=o=>p=>{if(o){const C=T.current;p===void 0?o(C):o(C,p)}},Q=j(D),V=j((o,p)=>{ae(o);const C=O({style:r,timeout:c,easing:v},{mode:"enter"});o.style.webkitTransition=n.transitions.create("transform",C),o.style.transition=n.transitions.create("transform",C),y&&y(o,p)}),Z=j(_),J=j(i),K=j(o=>{const p=O({style:r,timeout:c,easing:v},{mode:"exit"});o.style.webkitTransition=n.transitions.create("transform",p),o.style.transition=n.transitions.create("transform",p),b&&b(o)}),Y=j(t),U=o=>{g&&g(T.current,o)};return e.jsx(E,R({appear:k,in:m,nodeRef:T,onEnter:V,onEntered:Z,onEntering:Q,onExit:K,onExited:Y,onExiting:J,addEndListener:U,timeout:c},M,{children:(o,p)=>h.cloneElement(u,R({style:R({transform:"scale(0)",visibility:o==="exited"&&!m?"hidden":void 0},De[o],r,u.props.style),ref:N},p))}))});var F={},we=oe;Object.defineProperty(F,"__esModule",{value:!0});var W=F.default=void 0,ke=we(ne()),_e=e;W=F.default=(0,ke.default)((0,_e.jsx)("path",{d:"M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"}),"FormatQuote");const I="testimonials",L={async getAllTestimonials(){try{return(await de(ce(S,I))).docs.map(a=>{var l;return{id:a.id,...a.data(),date:(l=a.data().createdAt)!=null&&l.toDate?a.data().createdAt.toDate():new Date(a.data().createdAt||Date.now())}}).sort((a,l)=>l.date-a.date)}catch(d){return console.error("Error fetching testimonials:",d),[]}},async updateStatus(d,a){const l=$(S,I,d),n={status:a,approved:a==="approved"};a==="approved"&&(n.approvedAt=pe()),await le(l,n)},async deleteTestimonial(d){await ie($(S,I,d))}};function Oe(){var b;const[d,a]=h.useState([]),[l,n]=h.useState(!0),[s,g]=h.useState(null),[k,u]=h.useState(!1),v=async()=>{n(!0);const t=await L.getAllTestimonials();a(t),n(!1)};h.useEffect(()=>{v()},[]);const m=async(t,i,r)=>{t.stopPropagation(),await L.updateStatus(i,r),A.success(r==="approved"?"تمت الموافقة":"تم الرفض"),a(c=>c.map(E=>E.id===i?{...E,status:r,approved:r==="approved"}:E)),(s==null?void 0:s.id)===i&&g(c=>({...c,status:r,approved:r==="approved"}))},y=async(t,i)=>{if(t.stopPropagation(),window.confirm("هل أنت متأكد من الحذف؟ هذا الإجراء لا يمكن التراجع عنه."))try{await L.deleteTestimonial(i),A.success("تم الحذف بنجاح"),a(r=>r.filter(c=>c.id!==i)),(s==null?void 0:s.id)===i&&u(!1)}catch{A.error("فشل الحذف، يرجى المحاولة لاحقاً")}},_=t=>{g(t),u(!0)},D=t=>t.quote||t.message||t.text||t.comment||"لا يوجد نص متاح لهذا الرأي";return e.jsxs(x,{children:[e.jsxs(x,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(f,{variant:"h4",fontWeight:"bold",children:"إدارة آراء الطلاب"}),e.jsx(ge,{color:"primary",size:"small",onClick:v,children:e.jsx(je,{})})]}),l?e.jsx(x,{display:"flex",justifyContent:"center",height:"50vh",alignItems:"center",children:e.jsx(xe,{})}):e.jsx(q,{container:!0,spacing:3,children:e.jsx(ue,{children:d.map((t,i)=>e.jsx(q,{item:!0,xs:12,sm:6,md:4,children:e.jsx(fe.div,{layout:!0,initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.9},transition:{delay:i*.05},onClick:()=>_(t),style:{cursor:"pointer",height:"100%"},children:e.jsxs(x,{className:"glass-card",sx:{p:3,height:"100%",display:"flex",flexDirection:"column",position:"relative",transition:"0.3s",border:t.approved?"1px solid #4caf50":"1px solid rgba(255,255,255,0.1)","&:hover":{transform:"translateY(-5px)",borderColor:"var(--primary)",boxShadow:"0 10px 30px rgba(211, 47, 47, 0.1)"}},children:[e.jsx(W,{sx:{fontSize:40,color:"var(--primary)",opacity:.3,position:"absolute",top:10,left:10}}),e.jsxs(x,{sx:{mb:2,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(f,{variant:"h6",fontWeight:"bold",sx:{maxWidth:"70%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.name}),e.jsx(H,{label:t.status==="approved"?"معتمد":t.status==="rejected"?"مرفوض":"قيد الانتظار",color:t.status==="approved"?"success":t.status==="rejected"?"error":"warning",size:"small"})]}),e.jsxs(f,{variant:"body2",color:"text.secondary",sx:{mb:1},children:[t.major||t.role," - ",t.year?`السنة ${t.year}`:t.role||"طالب"]}),e.jsxs(f,{variant:"body1",sx:{minHeight:80,mb:2,fontStyle:"italic",color:"rgba(255,255,255,0.9)",display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden"},children:['"',D(t),'"']}),e.jsxs(x,{sx:{display:"flex",justifyContent:"flex-end",gap:1,mt:"auto",pt:2,borderTop:"1px solid rgba(255,255,255,0.05)"},children:[t.status!=="approved"&&e.jsx(z,{title:"اعتماد",children:e.jsx(w,{color:"success",size:"small",onClick:r=>m(r,t.id,"approved"),children:e.jsx(B,{})})}),t.status!=="rejected"&&e.jsx(z,{title:"رفض",children:e.jsx(w,{color:"warning",size:"small",onClick:r=>m(r,t.id,"rejected"),children:e.jsx(he,{})})}),e.jsx(z,{title:"حذف",children:e.jsx(w,{color:"error",size:"small",onClick:r=>y(r,t.id),children:e.jsx(G,{})})})]})]})})},t.id))})}),e.jsx(ve,{open:k,onClose:()=>u(!1),TransitionComponent:Te,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{background:"rgba(26, 26, 26, 0.95)",backdropFilter:"blur(10px)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:4}},children:s&&e.jsxs(e.Fragment,{children:[e.jsxs(ye,{sx:{pr:6},children:[e.jsxs(x,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(f,{variant:"h5",fontWeight:"bold",children:s.name}),e.jsx(H,{label:s.status==="approved"?"معتمد":s.status==="rejected"?"مرفوض":"قيد الانتظار",color:s.status==="approved"?"success":s.status==="rejected"?"error":"warning"})]}),e.jsx(w,{onClick:()=>u(!1),sx:{position:"absolute",right:8,top:8,color:"grey.500"},children:e.jsx(me,{})})]}),e.jsxs(be,{dividers:!0,sx:{borderColor:"rgba(255,255,255,0.1)"},children:[e.jsxs(f,{variant:"subtitle1",color:"primary",gutterBottom:!0,children:[s.major," - ",s.year?`السنة ${s.year}`:s.role]}),e.jsxs(x,{sx:{mt:3,p:3,bgcolor:"rgba(255,255,255,0.03)",borderRadius:2,position:"relative"},children:[e.jsx(W,{sx:{opacity:.1,fontSize:60,position:"absolute",top:-10,left:-10}}),e.jsx(f,{variant:"body1",sx:{fontStyle:"italic",lineHeight:1.8,position:"relative"},children:D(s)})]}),e.jsx(f,{variant:"caption",color:"text.secondary",sx:{display:"block",mt:2,textAlign:"left"},children:(b=s.date)==null?void 0:b.toLocaleDateString("ar-EG")})]}),e.jsxs(Ee,{sx:{p:2,gap:1},children:[e.jsx(P,{variant:"outlined",color:"error",startIcon:e.jsx(G,{}),onClick:t=>y(t,s.id),children:"حذف نهائي"}),e.jsx(x,{sx:{flexGrow:1}}),s.status!=="approved"&&e.jsx(P,{variant:"contained",color:"success",startIcon:e.jsx(B,{}),onClick:t=>m(t,s.id,"approved"),children:"اعتماد الرأي"}),s.status!=="rejected"&&e.jsx(P,{variant:"contained",color:"warning",onClick:t=>m(t,s.id,"rejected"),children:"رفض"})]})]})})]})}export{Oe as default};
