rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // Helper function to check if user is admin (you might need to adjust this depending on your auth setup)
    // For now, checks if the user is authenticated. Ideally, check for a specific admin custom claim or email.
    function isAdmin() {
      return request.auth != null; 
    }

    // Suggestions (Opinions/Feedback)
    match /suggestions/{suggestion} {
      allow read: if resource.data.isPublic == true || isAdmin();
      allow create: if true; // Public can submit
      allow update, delete: if isAdmin();
    }

    // Question Reports
    match /question_reports/{report} {
      allow read, update, delete: if isAdmin();
      allow create: if true; // Public can report
    }

    // Page Views (Analytics)
    match /page_views/{view} {
      allow read: if isAdmin();
      allow create: if true; // Public logs views
      allow update, delete: if false; // Analytics should be immutable
    }

    // Protected Admin Collections
    match /donations/{doc} {
      allow read, write: if isAdmin();
    }
    match /subscribers/{doc} {
      allow read, write: if isAdmin();
    }
    match /testimonials/{doc} {
      allow read: if resource.data.approved == true || isAdmin();
      allow create: if true;
      allow update, delete: if isAdmin();
    }
    match /requests/{doc} {
        allow read, write: if isAdmin();
    }
    
    // Default deny
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
